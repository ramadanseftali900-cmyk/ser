<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gelen Faturalar</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;background:#1B5E20;min-height:100vh;color:#fff}
.container{display:block;min-height:100vh;padding:20px}
.solSutun{width:450px;background:#000;position:fixed;left:-450px;top:0;height:100vh;z-index:1000;transition:left 0.3s ease;display:flex;flex-direction:column}
.solSutun.acik{left:0}
.solBaslik{font-size:20px;font-weight:900;color:#fff;text-align:center;padding:20px;border-bottom:2px solid #333;flex-shrink:0}
.firmaListesi{flex:1;overflow-y:auto;padding:20px}
.sagCekmece{width:400px;background:#000;position:fixed;right:-400px;top:0;height:100vh;z-index:1000;transition:right 0.3s ease;display:flex;flex-direction:column}
.sagCekmece.acik{right:0}
.sagCekmeceBaslik{font-size:20px;font-weight:900;color:#fff;text-align:center;padding:20px;border-bottom:2px solid #333;flex-shrink:0}
.sagCekmeceIcerik{flex:1;overflow-y:auto;padding:20px}
.firmaKart{background:#1a1a1a;border-radius:10px;padding:15px;margin-bottom:15px;border:2px solid #333}
.firmaHeader{display:flex;align-items:center;gap:10px;margin-bottom:12px;cursor:pointer}
.durumIsik{width:14px;height:14px;border-radius:50%;flex-shrink:0}
.durumIsik.kirmizi{background:#dc3545;box-shadow:0 0 8px #dc3545}
.durumIsik.yesil{background:#28a745;box-shadow:0 0 8px #28a745}
.firmaAdi{font-size:15px;font-weight:bold;color:#fff;flex:1}
.firmaToggle{color:#888;font-size:18px}
.firmaDetay{display:none;padding-top:10px;border-top:1px solid #333}
.firmaDetay.acik{display:block}
.inputGrup{margin-bottom:10px}
.inputGrup label{display:block;font-size:11px;color:#888;margin-bottom:4px}
.inputGrup input,.inputGrup select{width:100%;background:#000;border:1px solid #444;color:#fff;padding:8px 10px;border-radius:6px;font-size:12px}
.inputGrup input::placeholder{color:#555}
.inputGrup input:focus{outline:none;border-color:#28a745}
.firmaSecBtn{background:#28a745;color:#fff;border:none;padding:10px;border-radius:6px;font-size:12px;font-weight:bold;cursor:pointer;width:100%;margin-top:5px}
.firmaSecBtn:hover{background:#218838}
.secenekKart{background:#1a1a1a;border-radius:10px;padding:15px;margin-bottom:15px;border:2px solid #333}
.secenekBaslik{font-size:14px;font-weight:bold;color:#28a745;margin-bottom:10px;display:flex;align-items:center;gap:8px}
.secenekAciklama{font-size:12px;color:#888;margin-bottom:10px;line-height:1.5}
.webhookUrl{background:#000;border:1px solid #444;color:#28a745;padding:10px;border-radius:6px;font-size:11px;word-break:break-all;margin-bottom:10px}
.kopyalaBtn{background:#17a2b8;color:#fff;border:none;padding:8px 15px;border-radius:6px;font-size:11px;font-weight:bold;cursor:pointer;width:100%}
.kopyalaBtn:hover{background:#138496}
.getirBtn{background:#28a745;color:#fff;border:none;padding:12px;border-radius:6px;font-size:13px;font-weight:bold;cursor:pointer;width:100%}
.getirBtn:hover{background:#218838}
.yukleAlani{border:2px dashed #444;border-radius:10px;padding:30px;text-align:center;cursor:pointer;transition:border-color 0.3s}
.yukleAlani:hover{border-color:#28a745}
.yukleAlani input{display:none}
.yukleAlani span{color:#888;font-size:13px}
.sagSutun{width:100%}
.sagBaslik{font-size:24px;font-weight:900;margin-bottom:15px;color:#fff}
.tabloWrapper{background:#fff;border-radius:0 0 12px 12px;overflow-x:auto;box-shadow:0 4px 20px rgba(0,0,0,0.3)}
.faturaTablosu{width:100%;border-collapse:collapse;color:#000;font-size:13px}
.faturaTablosu th{background:#000;color:#fff;padding:15px 10px;text-align:left;font-weight:bold;white-space:nowrap}
.faturaTablosu td{padding:12px 10px;border-bottom:1px solid #eee;vertical-align:middle;white-space:nowrap}
.faturaTablosu tr:hover{background:#f5f5f5}
.forumBaslik{background:#000;color:#fff;padding:15px 20px;font-size:18px;font-weight:900;border-radius:12px 12px 0 0}
.islemBtn{padding:6px 12px;border:none;border-radius:6px;cursor:pointer;font-size:11px;font-weight:bold;margin-right:5px}
.indirBtn{background:#17a2b8;color:#fff}
.indirBtn:hover{background:#138496}
.silBtn{background:#dc3545;color:#fff}
.silBtn:hover{background:#c82333}
</style>
</head>
<body>
<div class="container">
<button class="sirketlerBtn" id="sirketlerBtn" onclick="solCekmeceToggle()" style="position:fixed;left:0;top:50%;transform:translateY(-50%);width:40px;height:120px;background:#000;color:#fff;border:none;border-radius:0 10px 10px 0;font-size:11px;font-weight:900;cursor:pointer;z-index:1001;writing-mode:vertical-rl">ŞİRKETLER</button>
<button class="seceneklerBtn" id="seceneklerBtn" onclick="sagCekmeceToggle()" style="position:fixed;right:0;top:50%;transform:translateY(-50%);width:40px;height:120px;background:#000;color:#fff;border:none;border-radius:10px 0 0 10px;font-size:11px;font-weight:900;cursor:pointer;z-index:1001;writing-mode:vertical-rl">SEÇENEKLER</button>
<div class="sagSutun">
<div class="sagBaslik">🧾 Gelen Faturalar</div>
<div class="forumBaslik">GELEN FATURALAR</div>
<div class="tabloWrapper">
<table class="faturaTablosu">
<thead>
<tr><th>Fatura No</th><th>ETTN</th><th>Tarih</th><th>Müşteri</th><th>Tutar</th><th>KDV</th><th>Toplam</th><th>Tip</th><th>Senaryo</th><th>Şirket</th><th>Durum</th><th>İşlem</th></tr>
</thead>
<tbody id="faturaListe"></tbody>
</table>
</div>
</div>

<!-- SOL ÇEKMECE -->
<div class="solSutun" id="solSutun">
<div class="solBaslik">🧾 FATURA ŞİRKETLERİ <span style="float:right;cursor:pointer;" onclick="solCekmeceKapat()">✕</span></div>
<div class="firmaListesi">

<!-- FİRMA BİLGİLERİ -->
<div class="firmaBilgiBox" style="background:#1a1a1a;border-radius:10px;padding:15px;margin-bottom:15px;border:2px solid #28a745">
<div class="firmaBilgiBaslik" onclick="firmaBilgiToggle()" style="font-size:13px;font-weight:bold;color:#28a745;margin-bottom:12px;text-align:center;cursor:pointer;display:flex;justify-content:space-between;align-items:center">
<span>🏢 FİRMA BİLGİLERİN (SENİN BİLGİLERİN)</span>
<span id="firmaBilgiToggleIcon">▼</span>
</div>
<div id="firmaBilgiDetay" style="display:none;padding-top:15px;">
<div class="inputGrup"><label>Firma Adı</label><input type="text" id="firmaAdi" placeholder="Senin firma adın"></div>
<div class="inputGrup"><label>Vergi Dairesi</label><input type="text" id="vergiDairesi" placeholder="Vergi dairesi"></div>
<div class="inputGrup"><label>Vergi No / TC</label><input type="text" id="vergiNo" placeholder="Vergi numarası veya TC"></div>
<div class="inputGrup"><label>Adres</label><input type="text" id="firmaAdres" placeholder="Firma adresi"></div>
<div class="inputGrup"><label>Telefon</label><input type="text" id="firmaTel" placeholder="Firma telefonu"></div>
<button class="firmaSecBtn" onclick="firmaBilgiKaydet()">💾 BİLGİLERİ KAYDET</button>
</div>
</div>

<div style="border-top:2px solid #333;margin:15px 0;"></div>

<div class="firmaKart" data-firma="PAX Fatura">
<div class="firmaHeader" onclick="firmaToggle(this)">
<div class="durumIsik kirmizi"></div>
<span class="firmaAdi">PAX Fatura</span>
<span class="firmaToggle">▼</span>
</div>
<div class="firmaDetay">
<div class="inputGrup"><label>API Adresi</label><input type="text" class="apiAdres" placeholder="https://api.paxfatura.com/..."></div>
<div class="inputGrup"><label>API Key</label><input type="text" class="apiKey" placeholder="API anahtarı"></div>
<div class="inputGrup"><label>Kullanıcı Adı</label><input type="text" class="kullaniciAdi" placeholder="Kullanıcı adı"></div>
<div class="inputGrup"><label>Şifre</label><input type="password" class="sifre" placeholder="Şifre"></div>
<button class="firmaSecBtn" onclick="firmaKaydetVeSec(this)">💾 KAYDET VE SEÇ</button>
</div>
</div>
<div class="firmaKart" data-firma="Paraşüt">
<div class="firmaHeader" onclick="firmaToggle(this)">
<div class="durumIsik kirmizi"></div>
<span class="firmaAdi">Paraşüt</span>
<span class="firmaToggle">▼</span>
</div>
<div class="firmaDetay">
<div class="inputGrup"><label>API Adresi</label><input type="text" class="apiAdres" placeholder="https://api.parasut.com/..."></div>
<div class="inputGrup"><label>API Key</label><input type="text" class="apiKey" placeholder="API anahtarı"></div>
<div class="inputGrup"><label>Kullanıcı Adı</label><input type="text" class="kullaniciAdi" placeholder="Kullanıcı adı"></div>
<div class="inputGrup"><label>Şifre</label><input type="password" class="sifre" placeholder="Şifre"></div>
<button class="firmaSecBtn" onclick="firmaKaydetVeSec(this)">💾 KAYDET VE SEÇ</button>
</div>
</div>
<div class="firmaKart" data-firma="Logo">
<div class="firmaHeader" onclick="firmaToggle(this)">
<div class="durumIsik kirmizi"></div>
<span class="firmaAdi">Logo</span>
<span class="firmaToggle">▼</span>
</div>
<div class="firmaDetay">
<div class="inputGrup"><label>API Adresi</label><input type="text" class="apiAdres" placeholder="https://api.logo.com.tr/..."></div>
<div class="inputGrup"><label>API Key</label><input type="text" class="apiKey" placeholder="API anahtarı"></div>
<div class="inputGrup"><label>Kullanıcı Adı</label><input type="text" class="kullaniciAdi" placeholder="Kullanıcı adı"></div>
<div class="inputGrup"><label>Şifre</label><input type="password" class="sifre" placeholder="Şifre"></div>
<button class="firmaSecBtn" onclick="firmaKaydetVeSec(this)">💾 KAYDET VE SEÇ</button>
</div>
</div>
</div>
</div>

<!-- SAĞ ÇEKMECE -->
<div class="sagCekmece" id="sagCekmece">
<div class="sagCekmeceBaslik">⚙️ FATURA ALMA SEÇENEKLERİ <span style="float:right;cursor:pointer;" onclick="sagCekmeceKapat()">✕</span></div>
<div class="sagCekmeceIcerik">
<div class="secenekKart">
<div class="secenekBaslik">🔗 Seçenek 1: Webhook (Otomatik)</div>
<div class="secenekAciklama">Fatura şirketine bu URL'i verin. Fatura kesilince otomatik olarak buraya düşer.</div>
<div class="webhookUrl" id="webhookUrl">https://sizin-site.com/webhook/fatura</div>
<button class="kopyalaBtn" onclick="webhookKopyala()">📋 URL'İ KOPYALA</button>
</div>
<div class="secenekKart">
<div class="secenekBaslik">📥 Seçenek 2: API ile Çekme</div>
<div class="secenekAciklama">Sol taraftan fatura şirketini seçin, sonra butona basarak faturaları çekin.</div>
<button class="getirBtn" onclick="faturalariGetir()">📥 FATURALARI GETİR</button>
</div>
<div class="secenekKart">
<div class="secenekBaslik">📤 Seçenek 3: Manuel Yükleme</div>
<div class="secenekAciklama">Fatura şirketinin panelinden indirdiğiniz PDF'i buraya yükleyin.</div>
<div class="yukleAlani" onclick="document.getElementById('pdfInput').click()">
<input type="file" id="pdfInput" accept=".pdf" onchange="pdfYukle(this)">
<span>📄 PDF dosyası seçmek için tıklayın</span>
</div>
</div>
</div>
</div>
</div>

<button style="background:#000;color:#fff;border:none;padding:10px 20px;border-radius:8px;font-size:14px;font-weight:bold;cursor:pointer;position:fixed;bottom:20px;right:20px;z-index:100" onclick="window.location.href='ana-sayfa.html'">ANA SAYFA</button>

<script src="site-config.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
<script src="firebase-config.js"></script>
<script>
var seciliFirma = null;
var seciliFirmaBilgi = null;

function solCekmeceToggle(){
  var cekmece = document.getElementById('solSutun');
  cekmece.classList.toggle('acik');
}
function solCekmeceKapat(){
  document.getElementById('solSutun').classList.remove('acik');
}
function sagCekmeceToggle(){
  var cekmece = document.getElementById('sagCekmece');
  cekmece.classList.toggle('acik');
}
function sagCekmeceKapat(){
  document.getElementById('sagCekmece').classList.remove('acik');
}
function firmaToggle(header){
  var detay = header.nextElementSibling;
  detay.classList.toggle('acik');
}
function firmaKaydetVeSec(btn){
  var kart = btn.closest('.firmaKart');
  var firma = kart.dataset.firma;
  var apiAdres = kart.querySelector('.apiAdres').value;
  var apiKey = kart.querySelector('.apiKey').value;
  if(!apiAdres && !apiKey){ alert('API bilgisi girin!'); return; }
  var isik = kart.querySelector('.durumIsik');
  isik.classList.remove('kirmizi');
  isik.classList.add('yesil');
  seciliFirma = firma;
  seciliFirmaBilgi = {apiAdres, apiKey};
  if(typeof basariSesCal === 'function') basariSesCal();
  alert('✅ ' + firma + ' seçildi!');
  solCekmeceKapat();
}
function webhookKopyala(){
  navigator.clipboard.writeText(document.getElementById('webhookUrl').textContent);
  if(typeof basariSesCal === 'function') basariSesCal();
  alert('✅ URL kopyalandı!');
}
function faturalariGetir(){
  if(!seciliFirma){ alert('Önce şirket seçin!'); return; }
  alert('📥 Faturalar çekiliyor...');
}
function pdfYukle(input){
  var file = input.files[0];
  if(!file) return;
  if(typeof basariSesCal === 'function') basariSesCal();
  alert('✅ PDF yüklendi: ' + file.name);
}
function faturalariYukle(){
  var tbody = document.getElementById('faturaListe');
  tbody.innerHTML = '<tr><td colspan="12" style="text-align:center;padding:30px;color:#999;">Yükleniyor...</td></tr>';
  database.ref('gelenFaturalar').on('value', function(snapshot){
    tbody.innerHTML = '';
    if(!snapshot.exists()){
      tbody.innerHTML = '<tr><td colspan="12" style="text-align:center;padding:30px;color:#999;">Henüz fatura yok.</td></tr>';
      return;
    }
    snapshot.forEach(function(child){
      var f = child.val();
      var tr = document.createElement('tr');
      tr.innerHTML = '<td>'+(f.faturaNo||'-')+'</td><td style="font-size:10px;">'+(f.ettn||'-')+'</td><td>'+(f.tarih||'-')+'</td><td>'+(f.musteri||'-')+'</td><td>'+(f.tutar||'-')+'</td><td>'+(f.kdv||'-')+'</td><td>'+(f.toplam||'-')+'</td><td>'+(f.tip||'-')+'</td><td>'+(f.senaryo||'-')+'</td><td>'+(f.sirket||'-')+'</td><td>'+(f.durum||'-')+'</td><td><button class="islemBtn indirBtn" onclick="faturaYazdir(\''+child.key+'\')">YAZDIR</button><button class="islemBtn silBtn" onclick="faturaSil(\''+child.key+'\')">SİL</button></td>';
      tbody.appendChild(tr);
    });
  });
}
function faturaYazdir(key){
  database.ref('gelenFaturalar/' + key).once('value', function(snapshot){
    if(!snapshot.exists()){ alert('Fatura bulunamadı!'); return; }
    var f = snapshot.val();
    var yazdirPencere = window.open('', '_blank', 'width=400,height=600');
    yazdirPencere.document.write('<html><head><title>Fatura</title>');
    yazdirPencere.document.write('<style>body{font-family:monospace;font-size:12px;padding:10px;margin:0}h2{text-align:center;margin:0 0 10px}hr{border:1px dashed #000}.satir{display:flex;justify-content:space-between;margin:5px 0}.etiket{font-weight:bold}.deger{text-align:right}</style>');
    yazdirPencere.document.write('</head><body>');
    yazdirPencere.document.write('<h2>FATURA</h2><hr>');
    yazdirPencere.document.write('<div class="satir"><span class="etiket">Fatura No:</span><span class="deger">'+(f.faturaNo||'-')+'</span></div>');
    yazdirPencere.document.write('<div class="satir"><span class="etiket">Tarih:</span><span class="deger">'+(f.tarih||'-')+'</span></div>');
    yazdirPencere.document.write('<div class="satir"><span class="etiket">Müşteri:</span><span class="deger">'+(f.musteri||'-')+'</span></div>');
    yazdirPencere.document.write('<hr>');
    yazdirPencere.document.write('<div class="satir"><span class="etiket">Tutar:</span><span class="deger">'+(f.tutar||'-')+'</span></div>');
    yazdirPencere.document.write('<div class="satir"><span class="etiket">KDV:</span><span class="deger">'+(f.kdv||'-')+'</span></div>');
    yazdirPencere.document.write('<div class="satir"><span class="etiket">TOPLAM:</span><span class="deger" style="font-size:14px;font-weight:bold">'+(f.toplam||'-')+'</span></div>');
    yazdirPencere.document.write('<hr>');
    yazdirPencere.document.write('<div class="satir"><span class="etiket">Tip:</span><span class="deger">'+(f.tip||'-')+'</span></div>');
    yazdirPencere.document.write('<div class="satir"><span class="etiket">Şirket:</span><span class="deger">'+(f.sirket||'-')+'</span></div>');
    yazdirPencere.document.write('<div style="text-align:center;margin-top:15px;font-size:10px">ETTN: '+(f.ettn||'-')+'</div>');
    yazdirPencere.document.write('</body></html>');
    yazdirPencere.document.close();
    yazdirPencere.print();
  });
}
function faturaSil(key){
  if(!confirm('Silmek istediğine emin misin?')) return;
  database.ref('gelenFaturalar/' + key).remove();
}
window.onload = function(){ faturalariYukle(); }
</script>

<!-- 🔔 SİPARİŞ SES SİSTEMİ - Her sayfada çalışır -->
<script src="ramco-beyin.js"></script>
<script src="ramco-widget.js"></script>
</body>
</html>
