<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ho≈ü Geldin</title>
<style>
* {margin:0;padding:0;box-sizing:border-box}
body {
  background: #000;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
  font-family: Arial, sans-serif;
}

/* 3D D√∂nen K√ºre */
.sphere {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 400px;
  height: 400px;
  border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, rgba(0,255,136,0.1), transparent 50%),
              radial-gradient(circle at 70% 70%, rgba(0,136,255,0.1), transparent 50%);
  border: 1px solid rgba(0,255,136,0.2);
  animation: rotateSphere 20s linear infinite;
  box-shadow: inset 0 0 60px rgba(0,255,136,0.1), 0 0 60px rgba(0,255,136,0.1);
}
@keyframes rotateSphere {
  from { transform: translate(-50%, -50%) rotateY(0deg) rotateX(15deg); }
  to { transform: translate(-50%, -50%) rotateY(360deg) rotateX(15deg); }
}

/* I≈üƒ±k Huzmesi */
.light-beam {
  position: fixed;
  top: -50%;
  left: 50%;
  width: 2px;
  height: 200%;
  background: linear-gradient(to bottom, transparent, rgba(0,255,136,0.3), transparent);
  animation: beamMove 8s ease-in-out infinite;
  transform-origin: center;
}
.light-beam:nth-child(2) { animation-delay: -2s; left: 30%; }
.light-beam:nth-child(3) { animation-delay: -4s; left: 70%; }
@keyframes beamMove {
  0%, 100% { transform: rotate(-20deg); opacity: 0.3; }
  50% { transform: rotate(20deg); opacity: 0.8; }
}

/* Duman/Sis */
.fog {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 200%;
  height: 30%;
  background: linear-gradient(to top, rgba(0,255,136,0.05), transparent);
  animation: fogMove 15s linear infinite;
}
@keyframes fogMove {
  from { transform: translateX(0); }
  to { transform: translateX(-50%); }
}

/* Yƒ±ldƒ±zlar */
.stars {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}
.star {
  position: absolute;
  background: #fff;
  border-radius: 50%;
  animation: twinkle 2s infinite;
}
@keyframes twinkle {
  0%, 100% { opacity: 0.3; }
  50% { opacity: 1; }
}

/* Konfeti */
.confetti {
  position: fixed;
  width: 10px;
  height: 10px;
  top: -10px;
  animation: confettiFall 3s linear forwards;
}
@keyframes confettiFall {
  to { top: 110%; transform: rotate(720deg); }
}

/* Ana i√ßerik */
.container {
  text-align: center;
  z-index: 10;
  padding: 20px;
}

/* Typing efekti i√ßin */
.selam {
  font-size: 28px;
  color: #888;
  margin-bottom: 10px;
  text-shadow: 0 0 10px rgba(255,255,255,0.3);
  min-height: 40px;
}

.isim-container {
  min-height: 100px;
  margin-bottom: 20px;
}
.isim {
  font-size: 72px;
  font-weight: 900;
  color: #fff;
  text-transform: uppercase;
  letter-spacing: 8px;
  text-shadow: 
    0 0 10px #00ff88,
    0 0 20px #00ff88,
    0 0 40px #00ff88,
    0 0 80px #00ff88;
  animation: glow 2s ease-in-out infinite alternate, float3d 3s ease-in-out infinite;
}
@keyframes glow {
  from { text-shadow: 0 0 10px #00ff88, 0 0 20px #00ff88, 0 0 40px #00ff88; }
  to { text-shadow: 0 0 20px #00ffaa, 0 0 40px #00ffaa, 0 0 60px #00ffaa, 0 0 100px #00ffaa; }
}
@keyframes float3d {
  0%, 100% { transform: perspective(500px) rotateX(5deg) rotateY(-5deg); }
  50% { transform: perspective(500px) rotateX(-5deg) rotateY(5deg); }
}

.mesaj {
  font-size: 36px;
  color: #00ff88;
  font-weight: bold;
  text-shadow: 0 0 15px #00ff88;
  margin-bottom: 20px;
}

/* Bilgi kartlarƒ± */
.info-cards {
  display: flex;
  gap: 15px;
  justify-content: center;
  flex-wrap: wrap;
  margin: 25px 0;
}
.info-card {
  background: rgba(0,255,136,0.1);
  border: 1px solid rgba(0,255,136,0.3);
  border-radius: 10px;
  padding: 12px 20px;
  min-width: 120px;
}
.info-card .label {
  font-size: 11px;
  color: #888;
  margin-bottom: 5px;
}
.info-card .value {
  font-size: 18px;
  color: #00ff88;
  font-weight: bold;
}

.motivasyon {
  font-size: 14px;
  color: #00aa66;
  font-style: italic;
  max-width: 400px;
  margin: 20px auto;
  padding: 15px;
  border: 1px solid rgba(0,255,136,0.2);
  border-radius: 10px;
  background: rgba(0,255,136,0.03);
}

/* Ba≈üla butonu */
.basla-btn {
  background: linear-gradient(135deg, #00ff88, #00aa55);
  color: #000;
  border: none;
  padding: 15px 50px;
  font-size: 20px;
  font-weight: bold;
  border-radius: 30px;
  cursor: pointer;
  margin-top: 20px;
  transition: all 0.3s;
  box-shadow: 0 0 30px rgba(0,255,136,0.5);
}
.basla-btn:hover {
  transform: scale(1.1);
  box-shadow: 0 0 50px rgba(0,255,136,0.8);
}

/* Ayarlar */
.settings {
  position: fixed;
  top: 20px;
  right: 20px;
  display: flex;
  gap: 10px;
  z-index: 100;
}
.setting-btn {
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.2);
  color: #fff;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  font-size: 18px;
  transition: all 0.3s;
}
.setting-btn:hover {
  background: rgba(0,255,136,0.3);
}
.setting-btn.active {
  background: rgba(0,255,136,0.5);
  border-color: #00ff88;
}

/* ƒ∞sim deƒüi≈ütirme modal */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.9);
  z-index: 200;
  justify-content: center;
  align-items: center;
}
.modal-content {
  background: #111;
  padding: 30px;
  border-radius: 15px;
  border: 1px solid #00ff88;
  text-align: center;
}
.modal-content h3 {
  color: #fff;
  margin-bottom: 20px;
}
.modal-content input {
  background: #222;
  border: 1px solid #444;
  color: #fff;
  padding: 12px 20px;
  font-size: 18px;
  border-radius: 8px;
  width: 250px;
  text-align: center;
}
.modal-content input:focus {
  outline: none;
  border-color: #00ff88;
}
.modal-btns {
  margin-top: 20px;
  display: flex;
  gap: 10px;
  justify-content: center;
}
.modal-btns button {
  padding: 10px 25px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
}
.modal-btns .kaydet {
  background: #00ff88;
  color: #000;
}
.modal-btns .iptal {
  background: #444;
  color: #fff;
}

/* Fade out */
.fade-out {
  animation: fadeOut 1s ease forwards;
}
@keyframes fadeOut {
  to { opacity: 0; }
}
</style>
</head>
<body>

<!-- Efektler -->
<div class="sphere"></div>
<div class="light-beam"></div>
<div class="light-beam"></div>
<div class="light-beam"></div>
<div class="fog"></div>
<div class="stars" id="stars"></div>
<div id="confettiContainer"></div>

<!-- Ayarlar -->
<div class="settings">
  <button class="setting-btn" id="soundBtn" onclick="toggleSound()" title="Ses">üîá</button>
  <button class="setting-btn" id="nameBtn" onclick="openNameModal()" title="ƒ∞sim Deƒüi≈ütir">‚úèÔ∏è</button>
</div>

<!-- ƒ∞sim Modal -->
<div class="modal" id="nameModal">
  <div class="modal-content">
    <h3>ƒ∞sminizi Girin</h3>
    <input type="text" id="nameInput" placeholder="ƒ∞sminiz...">
    <div class="modal-btns">
      <button class="kaydet" onclick="saveName()">Kaydet</button>
      <button class="iptal" onclick="closeNameModal()">ƒ∞ptal</button>
    </div>
  </div>
</div>

<!-- Ana ƒ∞√ßerik -->
<div class="container" id="container">
  <div class="selam" id="selam"></div>
  <div class="isim-container">
    <div class="isim" id="isim"></div>
  </div>
  <div class="mesaj">Hayƒ±rlƒ± ƒ∞≈üler</div>
  
  <div class="info-cards">
    <div class="info-card">
      <div class="label">üìÖ TARƒ∞H</div>
      <div class="value" id="tarih"></div>
    </div>
    <div class="info-card">
      <div class="label">üå°Ô∏è HAVA</div>
      <div class="value" id="hava">--¬∞C</div>
    </div>
    <div class="info-card">
      <div class="label">üéØ HEDEF</div>
      <div class="value" id="hedef">0 ‚Ç∫</div>
    </div>
    <div class="info-card">
      <div class="label">üì¶ D√úN</div>
      <div class="value" id="dunSiparis">0</div>
    </div>
  </div>
  
  <div class="motivasyon" id="motivasyon"></div>
  
  <button class="basla-btn" onclick="basla()">üöÄ BA≈ûLA</button>
</div>

<script src="site-config.js"></script>
<script src="firebase-config.js"></script>
<script type="module">
// Firebase mod√ºler SDK - dinamik config kullan
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
import { getDatabase, ref, get, query, orderByChild, startAt, endAt } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js";

// Kullanƒ±cƒ±nƒ±n Firebase config'ini localStorage'dan al
function getUserFirebaseConfig() {
    var saved = localStorage.getItem(getEkranKey('account_settings'));
    if (saved) {
        try {
            var s = JSON.parse(saved);
            if (s.firebaseApiKey && s.firebaseProjectId && s.firebaseDatabaseUrl) {
                return {
                    apiKey: s.firebaseApiKey,
                    authDomain: s.firebaseProjectId + ".firebaseapp.com",
                    databaseURL: s.firebaseDatabaseUrl,
                    projectId: s.firebaseProjectId,
                    storageBucket: s.firebaseProjectId + ".appspot.com"
                };
            }
        } catch(e) {}
    }
    return null;
}

var MERKEZI_CONFIG = getUserFirebaseConfig();

// Site ID'li localStorage key
function getEkranKey(key) {
    if (typeof getSiteKey === 'function') return getSiteKey(key);
    if (typeof SITE_ID !== 'undefined') return SITE_ID + '_' + key;
    return key;
}

// Domain ID olu≈ütur
function getEkranDomainId() {
    var domain = window.location.hostname;
    if (!domain || domain === '' || domain === 'localhost') {
        var path = window.location.pathname;
        domain = path.replace(/[^a-zA-Z0-9]/g, '_');
    }
    return domain.replace(/\./g, '_').replace(/-/g, '_');
}

// Firebase config'i localStorage'dan al
function getEkranFirebaseConfig() {
    var saved = localStorage.getItem(getEkranKey('account_settings'));
    if (saved) {
        try {
            var s = JSON.parse(saved);
            if (s.firebaseApiKey && s.firebaseProjectId && s.firebaseDatabaseUrl) {
                return {
                    apiKey: s.firebaseApiKey,
                    authDomain: s.firebaseProjectId + ".firebaseapp.com",
                    databaseURL: s.firebaseDatabaseUrl,
                    projectId: s.firebaseProjectId,
                    storageBucket: s.firebaseProjectId + ".appspot.com"
                };
            }
        } catch(e) {}
    }
    return null;
}

// Merkezi Firebase'den ayarlarƒ± √ßek ve localStorage'a kaydet
async function merkezidenAyarlariCek() {
    try {
        var merkeziApp;
        try {
            merkeziApp = initializeApp(MERKEZI_CONFIG, 'merkezi-ekran');
        } catch(e) {
            // Zaten varsa al
            var apps = [];
            try { apps = firebase.apps || []; } catch(ex) {}
            merkeziApp = apps.find(a => a.name === 'merkezi-ekran');
            if (!merkeziApp) {
                merkeziApp = initializeApp(MERKEZI_CONFIG, 'merkezi-ekran');
            }
        }
        var merkeziDb = getDatabase(merkeziApp);
        var domainId = getEkranDomainId();
        
        console.log('üîÑ Merkezi Firebase\'den ayarlar √ßekiliyor... (Domain:', domainId + ')');
        
        var snapshot = await get(ref(merkeziDb, 'site_ayarlari/' + domainId));
        
        if (snapshot.exists()) {
            var ayarlar = snapshot.val();
            if (ayarlar && ayarlar.firebaseApiKey) {
                console.log('‚úÖ Merkezi Firebase\'den ayarlar alƒ±ndƒ±!');
                
                // localStorage'a kaydet
                var siteKey = getEkranKey('account_settings');
                var settings = JSON.parse(localStorage.getItem(siteKey) || '{}');
                settings.firebaseApiKey = ayarlar.firebaseApiKey;
                settings.firebaseProjectId = ayarlar.firebaseProjectId;
                settings.firebaseDatabaseUrl = ayarlar.firebaseDatabaseUrl;
                localStorage.setItem(siteKey, JSON.stringify(settings));
                
                return {
                    apiKey: ayarlar.firebaseApiKey,
                    authDomain: ayarlar.firebaseProjectId + ".firebaseapp.com",
                    databaseURL: ayarlar.firebaseDatabaseUrl,
                    projectId: ayarlar.firebaseProjectId,
                    storageBucket: ayarlar.firebaseProjectId + ".appspot.com"
                };
            }
        }
        console.log('‚ö†Ô∏è Merkezi Firebase\'de bu domain i√ßin ayar yok');
        return null;
    } catch(e) {
        console.log('‚ö†Ô∏è Merkezi Firebase eri≈üim hatasƒ±:', e.message);
        return null;
    }
}

// Firebase'i ba≈ülat ve verileri y√ºkle
async function initAndLoadData() {
    var app = null;
    var db = null;
    
    // √ñnce localStorage'dan dene
    var ekranFirebaseConfig = getEkranFirebaseConfig();
    
    if (ekranFirebaseConfig) {
        console.log('‚úÖ localStorage\'dan ayarlar kullanƒ±lƒ±yor');
        try {
            app = initializeApp(ekranFirebaseConfig, 'ekran-app');
            db = getDatabase(app);
        } catch(e) {
            console.log('Firebase app zaten var, kullanƒ±lƒ±yor');
        }
    } else {
        // localStorage'da yoksa merkezi Firebase'den √ßek
        ekranFirebaseConfig = await merkezidenAyarlariCek();
        if (ekranFirebaseConfig) {
            try {
                app = initializeApp(ekranFirebaseConfig, 'ekran-app');
                db = getDatabase(app);
            } catch(e) {
                console.log('Firebase app zaten var, kullanƒ±lƒ±yor');
            }
        }
    }
    
    // Firebase verileri y√ºkle
    if (db) {
        // G√ºnl√ºk hedef √ßek
        try {
            var hedefSnapshot = await get(ref(db, 'ayarlar/gunlukHedef'));
            var hedef = hedefSnapshot.exists() ? hedefSnapshot.val() : 5000;
            document.getElementById('hedef').textContent = Number(hedef).toLocaleString('tr-TR') + ' ‚Ç∫';
        } catch(e) {
            document.getElementById('hedef').textContent = '5.000 ‚Ç∫';
        }
        
        // D√ºnk√º sipari≈üleri √ßek
        var dun = new Date();
        dun.setDate(dun.getDate() - 1);
        var dunStr = dun.getFullYear() + '-' + String(dun.getMonth()+1).padStart(2,'0') + '-' + String(dun.getDate()).padStart(2,'0');
        var dunBaslangic = dunStr + 'T00:00:00';
        var dunBitis = dunStr + 'T23:59:59';
        
        try {
            var siparisSnapshot = await get(ref(db, 'siparisler'));
            var dunSayisi = 0;
            if(siparisSnapshot.exists()) {
                siparisSnapshot.forEach(function(child) {
                    var siparis = child.val();
                    var tarih = siparis.tarih || siparis.createdAt || '';
                    if(tarih >= dunBaslangic && tarih <= dunBitis) {
                        dunSayisi++;
                    }
                });
            }
            document.getElementById('dunSiparis').textContent = dunSayisi + ' adet';
        } catch(e) {
            document.getElementById('dunSiparis').textContent = '0 adet';
        }
    } else {
        document.getElementById('hedef').textContent = '5.000 ‚Ç∫';
        document.getElementById('dunSiparis').textContent = '0 adet';
    }
}

// Firebase verilerini y√ºkle
initAndLoadData();

var isim = localStorage.getItem(getEkranKey('kullanici_isim')) || 'KULLANICI';
var soundEnabled = localStorage.getItem(getEkranKey('sound_enabled')) !== 'false'; // Varsayƒ±lan A√áIK

// Ses dosyalarƒ± - Base64 encoded kƒ±sa ses
var welcomeSound = new Audio('data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAABhgC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7//////////////////////////////////////////////////////////////////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAAAAAAAAAAAAYYNBrv+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAABhgC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7//////////////////////////////////////////////////////////////////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAAAAAAAAAAAAYYNBrv+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA');
welcomeSound.volume = 0.5;

// Web Audio API ile ses √ºret
function playBeep(frequency, duration) {
  var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  var oscillator = audioCtx.createOscillator();
  var gainNode = audioCtx.createGain();
  
  oscillator.connect(gainNode);
  gainNode.connect(audioCtx.destination);
  
  oscillator.frequency.value = frequency;
  oscillator.type = 'sine';
  gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
  gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
  
  oscillator.start(audioCtx.currentTime);
  oscillator.stop(audioCtx.currentTime + duration);
}

function playWelcomeSound() {
  // √ñnce IndexedDB'den √∂zel ses var mƒ± kontrol et
  var siteId = typeof SITE_ID !== 'undefined' ? SITE_ID : (localStorage.getItem('__SITE_ID__') || '');
  var dbName = siteId ? siteId + '_ramco_ses_db' : 'ramco_ses_db';
  
  var request = indexedDB.open(dbName, 1);
  
  request.onerror = function() {
    // IndexedDB a√ßƒ±lamazsa localStorage'dan dene
    playWelcomeSoundLocalStorage();
  };
  
  request.onupgradeneeded = function(e) {
    var db = e.target.result;
    if (!db.objectStoreNames.contains('sesler')) {
      db.createObjectStore('sesler', { keyPath: 'tip' });
    }
  };
  
  request.onsuccess = function() {
    var db = request.result;
    try {
      var transaction = db.transaction(['sesler'], 'readonly');
      var store = transaction.objectStore('sesler');
      var getRequest = store.get('ekran');
      
      getRequest.onsuccess = function() {
        var ses = getRequest.result;
        if (ses && ses.data) {
          var audio = new Audio(ses.data);
          audio.volume = 0.5;
          audio.play().catch(function(e) { console.log('Ses √ßalma hatasƒ±:', e); });
          console.log('üîä Ekran sesi √ßalƒ±yor (IndexedDB):', ses.isim);
        } else {
          playWelcomeSoundLocalStorage();
        }
      };
      
      getRequest.onerror = function() {
        playWelcomeSoundLocalStorage();
      };
    } catch(e) {
      playWelcomeSoundLocalStorage();
    }
  };
}

function playWelcomeSoundLocalStorage() {
  // localStorage'dan √∂zel ses var mƒ± kontrol et
  var kayitliSesler = localStorage.getItem(getEkranKey('ramco_sesler'));
  if (kayitliSesler) {
    try {
      var sesler = JSON.parse(kayitliSesler);
      if (sesler.ekran && sesler.ekran.data) {
        var audio = new Audio(sesler.ekran.data);
        audio.volume = 0.5;
        audio.play();
        console.log('üîä Ekran sesi √ßalƒ±yor (localStorage)');
        return;
      }
    } catch(e) {}
  }
  
  // √ñzel ses yoksa varsayƒ±lan melodi √ßal
  playDefaultMelody();
}

function playDefaultMelody() {
  var ctx = new (window.AudioContext || window.webkitAudioContext)();
  
  var notalar = [
    { frek: 330, sure: 150, tip: 'sine' },
    { frek: 392, sure: 150, tip: 'sine' },
    { frek: 440, sure: 150, tip: 'sine' },
    { frek: 523, sure: 200, tip: 'sine' },
    { frek: 587, sure: 150, tip: 'sine' },
    { frek: 659, sure: 150, tip: 'sine' },
    { frek: 698, sure: 150, tip: 'sine' },
    { frek: 784, sure: 200, tip: 'sine' },
    { frek: 880, sure: 150, tip: 'sine' },
    { frek: 988, sure: 150, tip: 'sine' },
    { frek: 1047, sure: 300, tip: 'sine' },
    { frek: 988, sure: 150, tip: 'sine' },
    { frek: 880, sure: 150, tip: 'sine' },
    { frek: 784, sure: 400, tip: 'sine' }
  ];
  
  var zaman = 0;
  
  notalar.forEach(function(nota) {
    setTimeout(function() {
      var osc = ctx.createOscillator();
      var gain = ctx.createGain();
      osc.connect(gain);
      gain.connect(ctx.destination);
      
      osc.frequency.value = nota.frek;
      osc.type = nota.tip;
      gain.gain.value = 0.2;
      
      osc.start();
      gain.gain.setValueAtTime(0.2, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + nota.sure / 1000);
      osc.stop(ctx.currentTime + nota.sure / 1000 + 0.05);
    }, zaman);
    
    zaman += nota.sure - 30;
  });
}

function playConfettiSound() {
  playBeep(784, 0.1);
  setTimeout(function() { playBeep(988, 0.1); }, 100);
  setTimeout(function() { playBeep(1175, 0.2); }, 200);
}

// Sayfa y√ºklenince ses √ßal
if(soundEnabled) {
  document.getElementById('soundBtn').textContent = 'üîä';
  document.getElementById('soundBtn').classList.add('active');
}

// Ses √ßalƒ±ndƒ± mƒ± kontrol√º
var sesCaldi = false;

// Sayfa a√ßƒ±lƒ±nca herhangi bir yere tƒ±klayƒ±nca ses √ßalsƒ±n
document.body.addEventListener('click', function() {
  if(soundEnabled && !sesCaldi) {
    playWelcomeSound();
    sesCaldi = true;
  }
});

// Yƒ±ldƒ±zlarƒ± olu≈ütur
var starsContainer = document.getElementById('stars');
for(var i = 0; i < 80; i++) {
  var star = document.createElement('div');
  star.className = 'star';
  star.style.left = Math.random() * 100 + '%';
  star.style.top = Math.random() * 100 + '%';
  star.style.width = Math.random() * 3 + 1 + 'px';
  star.style.height = star.style.width;
  star.style.animationDelay = Math.random() * 2 + 's';
  starsContainer.appendChild(star);
}

// Typing efekti
function typeText(element, text, speed, callback) {
  var i = 0;
  element.textContent = '';
  var timer = setInterval(function() {
    if(i < text.length) {
      element.textContent += text.charAt(i);
      i++;
    } else {
      clearInterval(timer);
      if(callback) callback();
    }
  }, speed);
}

// Saate g√∂re selam
var saat = new Date().getHours();
var selamText = '';
if(saat >= 6 && saat < 12) {
  selamText = '‚òÄÔ∏è G√ºnaydƒ±n';
} else if(saat >= 12 && saat < 18) {
  selamText = 'üå§Ô∏è ƒ∞yi G√ºnler';
} else {
  selamText = 'üåô ƒ∞yi Ak≈üamlar';
}

// Typing ile g√∂ster
setTimeout(function() {
  typeText(document.getElementById('selam'), selamText, 80, function() {
    typeText(document.getElementById('isim'), isim, 100);
  });
}, 500);

// Tarih
var bugun = new Date();
var tarihStr = bugun.getDate() + '/' + (bugun.getMonth()+1);
document.getElementById('tarih').textContent = tarihStr;

// Hava durumu - Kullanƒ±cƒ±nƒ±n ≈üehrine g√∂re
var sehirKoordinatlari = {
  'istanbul': { lat: 41.01, lon: 28.95 },
  'ankara': { lat: 39.93, lon: 32.86 },
  'izmir': { lat: 38.42, lon: 27.13 },
  'bursa': { lat: 40.19, lon: 29.06 },
  'antalya': { lat: 36.90, lon: 30.70 },
  'adana': { lat: 37.00, lon: 35.32 },
  'konya': { lat: 37.87, lon: 32.48 },
  'gaziantep': { lat: 37.06, lon: 37.38 },
  'mersin': { lat: 36.80, lon: 34.64 },
  'diyarbakir': { lat: 37.91, lon: 40.24 },
  'kayseri': { lat: 38.73, lon: 35.48 },
  'eskisehir': { lat: 39.78, lon: 30.52 },
  'samsun': { lat: 41.29, lon: 36.33 },
  'denizli': { lat: 37.77, lon: 29.09 },
  'trabzon': { lat: 41.00, lon: 39.72 },
  'malatya': { lat: 38.35, lon: 38.31 },
  'erzurum': { lat: 39.90, lon: 41.27 },
  'van': { lat: 38.49, lon: 43.38 },
  'batman': { lat: 37.88, lon: 41.13 },
  'elazig': { lat: 38.67, lon: 39.22 }
};

// IP'den ≈üehir tespiti
fetch('https://ipapi.co/json/')
  .then(function(r) { return r.json(); })
  .then(function(ipData) {
    var sehir = (ipData.city || 'istanbul').toLowerCase()
      .replace('ƒ±', 'i').replace('≈ü', 's').replace('ƒü', 'g')
      .replace('√º', 'u').replace('√∂', 'o').replace('√ß', 'c');
    
    var koord = sehirKoordinatlari[sehir] || sehirKoordinatlari['istanbul'];
    var sehirAdi = ipData.city || 'ƒ∞stanbul';
    
    // Hava durumu API
    return fetch('https://api.open-meteo.com/v1/forecast?latitude=' + koord.lat + '&longitude=' + koord.lon + '&current_weather=true')
      .then(function(r) { return r.json(); })
      .then(function(data) {
        var sicaklik = Math.round(data.current_weather.temperature);
        document.getElementById('hava').textContent = sicaklik + '¬∞C';
        document.getElementById('hava').title = sehirAdi;
      });
  })
  .catch(function() {
    // Fallback: ƒ∞stanbul
    fetch('https://api.open-meteo.com/v1/forecast?latitude=41.01&longitude=28.95&current_weather=true')
      .then(function(r) { return r.json(); })
      .then(function(data) {
        document.getElementById('hava').textContent = Math.round(data.current_weather.temperature) + '¬∞C';
      })
      .catch(function() {
        document.getElementById('hava').textContent = '--¬∞C';
      });
  });

// Motivasyon
var sozler = [
  '"Ba≈üarƒ±, her g√ºn tekrarlanan k√º√ß√ºk √ßabalarƒ±n toplamƒ±dƒ±r."',
  '"Bug√ºn zor, yarƒ±n daha zor, ama ertesi g√ºn g√ºne≈üli."',
  '"Hayal et, inan, ba≈üar."',
  '"K√º√ß√ºk adƒ±mlar b√ºy√ºk yolculuklar ba≈ülatƒ±r."',
  '"Bug√ºn ektiƒüin, yarƒ±n bi√ßersin."',
  '"Her usta bir zamanlar √ßƒ±raktƒ±."',
  '"Ba≈ülamak, bitirmenin yarƒ±sƒ±dƒ±r."',
  '"Fƒ±rtƒ±nalar g√º√ßl√º kaptanlar yeti≈ütirir."'
];
document.getElementById('motivasyon').textContent = sozler[Math.floor(Math.random() * sozler.length)];

// Konfeti patlamasƒ±
function createConfetti() {
  var colors = ['#00ff88', '#ff0088', '#0088ff', '#ffff00', '#ff8800'];
  for(var i = 0; i < 50; i++) {
    setTimeout(function() {
      var conf = document.createElement('div');
      conf.className = 'confetti';
      conf.style.left = Math.random() * 100 + '%';
      conf.style.background = colors[Math.floor(Math.random() * colors.length)];
      conf.style.width = Math.random() * 10 + 5 + 'px';
      conf.style.height = conf.style.width;
      conf.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
      conf.style.animationDuration = Math.random() * 2 + 2 + 's';
      document.getElementById('confettiContainer').appendChild(conf);
      setTimeout(function() { conf.remove(); }, 4000);
    }, i * 30);
  }
}
setTimeout(createConfetti, 1500);

// Ses toggle
window.toggleSound = function() {
  soundEnabled = !soundEnabled;
  localStorage.setItem(getEkranKey('sound_enabled'), soundEnabled);
  document.getElementById('soundBtn').textContent = soundEnabled ? 'üîä' : 'üîá';
  document.getElementById('soundBtn').classList.toggle('active', soundEnabled);
  if(soundEnabled) {
    playWelcomeSound();
  }
}

// ƒ∞sim modal
window.openNameModal = function() {
  document.getElementById('nameModal').style.display = 'flex';
  document.getElementById('nameInput').value = isim;
  document.getElementById('nameInput').focus();
}
window.closeNameModal = function() {
  document.getElementById('nameModal').style.display = 'none';
}
window.saveName = function() {
  var yeniIsim = document.getElementById('nameInput').value.trim().toUpperCase();
  if(yeniIsim) {
    localStorage.setItem(getEkranKey('kullanici_isim'), yeniIsim);
    isim = yeniIsim;
    document.getElementById('isim').textContent = isim;
  }
  closeNameModal();
}

// Ba≈üla butonu
window.basla = function() {
  if(soundEnabled) {
    playConfettiSound();
  }
  createConfetti();
  setTimeout(function() {
    document.body.classList.add('fade-out');
    setTimeout(function() {
      window.location.href = 'ana-sayfa.html';
    }, 1000);
  }, 500);
}
</script>
</body>
</html>